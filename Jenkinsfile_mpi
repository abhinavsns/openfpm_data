#!groovy

parallel (

<<<<<<< HEAD
"ubuntu" : {node ('cifarm-ubuntu-node')
=======
"cifarm-ubuntu-node" : {node ('cifarm-ubuntu-node')
>>>>>>> origin/master
                  {
                    deleteDir()

                    int ntry = 5
                    while (ntry != 0)
                    {
                      try {
                        checkout scm
                        ntry = 0
                      }
                      catch (IOException e)
                      {
                        ntry--
<<<<<<< HEAD
                        sleep(10)
                      }
                    }

                    stage ('ubuntu build')
                    {
                      sh "./build.sh $WORKSPACE $NODE_NAME NO $BRANCH_NAME"
                    }

                    stage ('ubuntu run')
                    {
                      sh "cd openfpm_data && ./run.sh $WORKSPACE $NODE_NAME NO"
                      sh "cd openfpm_data && ./success.sh 2 ubuntu openfpm_data"
=======
                        sleep(50)
                      }
                    }

                    stage ('build ubuntu')
                    {
                      sh "./build.sh $WORKSPACE $NODE_NAME $BRANCH_NAME"
                    }

                    stage ('run ubuntu')
                    {
                      sh "cd openfpm_io && ./run.sh $WORKSPACE $NODE_NAME $BRANCH_NAME"
                      sh "cd openfpm_io && ./success.sh 2 ubuntu openfpm_io"
>>>>>>> origin/master
                    }
                  }
                 },


<<<<<<< HEAD

"macosx" : {node ('cifarm-mac-node')
=======
"cifarm-mac-node" : {node ('cifarm-mac-node')
                  {
                    deleteDir()
                    env.PATH = "/usr/local/bin:${env.PATH}"

                    int ntry = 5
                    while (ntry != 0)
                    {
                      try {
                        checkout scm
                        ntry = 0
                      }
                      catch (IOException e)
                      {
                        ntry--
                        sleep(50)
                      }
                    }

                    stage ('build mac')
                    {
                      sh "echo $PATH && ./build.sh $WORKSPACE $NODE_NAME $BRANCH_NAME"
                    }

                    stage ('run mac')
                    {
                      sh "cd openfpm_io && ./run.sh $WORKSPACE $NODE_NAME $BRANCH_NAME"
                      sh "cd openfpm_io && ./success.sh 2 mac openfpm_io"
                    }
                  }
                 },

"cifarm-centos-node" : {node ('cifarm-centos-node')
>>>>>>> origin/master
                  {
                    deleteDir()

                    int ntry = 5
                    while (ntry != 0)
                    {
                      try {
                        checkout scm
                        ntry = 0
                      }
                      catch (IOException e)
                      {
                        ntry--
<<<<<<< HEAD
                        sleep(10)
                      }
                    }

                    stage ('macos build')
                    {
                      sh "./build.sh $WORKSPACE $NODE_NAME NO $BRANCH_NAME"
                    }

                    stage ('macos run')
                    {
                      sh "cd openfpm_data && ./run.sh $WORKSPACE $NODE_NAME NO"
                      sh "cd openfpm_data && ./success.sh 2 centos openfpm_data"
                    }
                  }
                 },

"centos" : {node ('cifarm-centos-node')
                  {
                    deleteDir()

                    int ntry = 5
                    while (ntry != 0)
                    {
                      try {
                        checkout scm
                        ntry = 0
                      }
                      catch (IOException e)
                      {
                        ntry--
                        sleep(10)
                      }
                    }

                    stage ('centos build')
                    {
                      sh "./build.sh $WORKSPACE $NODE_NAME NO $BRANCH_NAME"
                    }

                    stage ('centos run')
                    {
                      sh "cd openfpm_data && ./run.sh $WORKSPACE $NODE_NAME NO"
                      sh "cd openfpm_data && ./success.sh 2 centos openfpm_data"
                    }
                  }
                 },



=======
                        sleep(50)
                      }
                    }

                    stage ('build_gin')
                    {
                      sh "echo $PATH && ./build.sh $WORKSPACE $NODE_NAME $BRANCH_NAME"
                    }

                    stage ('run_gin')
                    {
                      sh "cd openfpm_io && ./run.sh $WORKSPACE $NODE_NAME $BRANCH_NAME"
                      sh "cd openfpm_io && ./success.sh 2 centos openfpm_io"
                    }
                  }
                 }
>>>>>>> origin/master
)

